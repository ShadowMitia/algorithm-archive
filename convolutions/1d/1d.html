<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Convolutions in 1D - Arcane Algorithm Archive</title>


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../index.html"><strong aria-hidden="true">1.</strong> Algorithm Archive</a></li><li class="chapter-item expanded "><a href="../../introduction/introduction.html"><strong aria-hidden="true">2.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../how_to_contribute/how_to_contribute.html"><strong aria-hidden="true">3.</strong> How To Contribute</a></li><li class="chapter-item expanded "><a href="../../plotting/plotting.html"><strong aria-hidden="true">4.</strong> Plotting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../domain_coloring/domain_coloring.html"><strong aria-hidden="true">4.1.</strong> Domain Coloring</a></li><li class="chapter-item expanded "><a href="../../IFS/IFS.html"><strong aria-hidden="true">4.2.</strong> Iterated Function Systems</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../barnsley/barnsley.html"><strong aria-hidden="true">4.2.1.</strong> The Barnsley Fern</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../data_structures/data_structures.html"><strong aria-hidden="true">5.</strong> Data Structures</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../stacks_and_queues/stacks_and_queues.html"><strong aria-hidden="true">5.1.</strong> Stacks and Queues</a></li></ol></li><li class="chapter-item expanded "><a href="../../mathematical_background/mathematical_background.html"><strong aria-hidden="true">6.</strong> Mathematical Background</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../notation/notation.html"><strong aria-hidden="true">6.1.</strong> Complexity Notation</a></li><li class="chapter-item expanded "><a href="../../affine_transformations/affine_transformations.html"><strong aria-hidden="true">6.2.</strong> Affine Transformations</a></li><li class="chapter-item expanded "><a href="../../bitlogic/bitlogic.html"><strong aria-hidden="true">6.3.</strong> Bit Logic</a></li><li class="chapter-item expanded "><a href="../../taylor_series_expansion/taylor_series_expansion.html"><strong aria-hidden="true">6.4.</strong> Taylor Series</a></li><li class="chapter-item expanded "><a href="../../convolutions/convolutions.html"><strong aria-hidden="true">6.5.</strong> Convolutions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../convolutions/1d/1d.html" class="active"><strong aria-hidden="true">6.5.1.</strong> Convolutions in 1D</a></li><li class="chapter-item expanded "><a href="../../convolutions/multiplication/multiplication.html"><strong aria-hidden="true">6.5.2.</strong> Multiplication as a Convolution</a></li><li class="chapter-item expanded "><a href="../../convolutions/2d/2d.html"><strong aria-hidden="true">6.5.3.</strong> Convolutions of Images (2D)</a></li><li class="chapter-item expanded "><a href="../../convolutions/convolutional_theorem/convolutional_theorem.html"><strong aria-hidden="true">6.5.4.</strong> Convolutional Theorem</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../tree_traversal/tree_traversal.html"><strong aria-hidden="true">7.</strong> Tree Traversal</a></li><li class="chapter-item expanded "><a href="../../euclidean_algorithm/euclidean_algorithm.html"><strong aria-hidden="true">8.</strong> Euclidean Algorithm</a></li><li class="chapter-item expanded "><a href="../../monte_carlo_integration/monte_carlo_integration.html"><strong aria-hidden="true">9.</strong> Monte Carlo</a></li><li class="chapter-item expanded "><a href="../../matrix_methods/matrix_methods.html"><strong aria-hidden="true">10.</strong> Matrix Methods</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../gaussian_elimination/gaussian_elimination.html"><strong aria-hidden="true">10.1.</strong> Gaussian Elimination</a></li><li class="chapter-item expanded "><a href="../../thomas_algorithm/thomas_algorithm.html"><strong aria-hidden="true">10.2.</strong> Thomas Algorithm</a></li></ol></li><li class="chapter-item expanded "><a href="../../computational_geometry/computational_geometry.html"><strong aria-hidden="true">11.</strong> Computational Geometry</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../gift_wrapping/gift_wrapping.html"><strong aria-hidden="true">11.1.</strong> Gift Wrapping</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../jarvis_march/jarvis_march.html"><strong aria-hidden="true">11.1.1.</strong> Jarvis March</a></li><li class="chapter-item expanded "><a href="../../graham_scan/graham_scan.html"><strong aria-hidden="true">11.1.2.</strong> Graham Scan</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../cooley_tukey/cooley_tukey.html"><strong aria-hidden="true">12.</strong> FFT</a></li><li class="chapter-item expanded "><a href="../../decision_problems/decision_problems.html"><strong aria-hidden="true">13.</strong> Decision Problems</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../stable_marriage_problem/stable_marriage_problem.html"><strong aria-hidden="true">13.1.</strong> Stable Marriage Problem</a></li></ol></li><li class="chapter-item expanded "><a href="../../physics_solvers/physics_solvers.html"><strong aria-hidden="true">14.</strong> Physics Solvers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../verlet_integration/verlet_integration.html"><strong aria-hidden="true">14.1.</strong> Verlet Integration</a></li><li class="chapter-item expanded "><a href="../../quantum_systems/quantum_systems.html"><strong aria-hidden="true">14.2.</strong> Quantum Systems</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../split-operator_method/split-operator_method.html"><strong aria-hidden="true">14.2.1.</strong> Split-Operator Method</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../data_compression/data_compression.html"><strong aria-hidden="true">15.</strong> Data Compression</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../huffman_encoding/huffman_encoding.html"><strong aria-hidden="true">15.1.</strong> Huffman Encoding</a></li></ol></li><li class="chapter-item expanded "><a href="../../computer_graphics/computer_graphics.html"><strong aria-hidden="true">16.</strong> Computer Graphics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../flood_fill/flood_fill.html"><strong aria-hidden="true">16.1.</strong> Flood Fill</a></li></ol></li><li class="chapter-item expanded "><a href="../../quantum_information/quantum_information.html"><strong aria-hidden="true">17.</strong> Quantum Information</a></li><li class="chapter-item expanded "><a href="../../computus/computus.html"><strong aria-hidden="true">18.</strong> Computus</a></li><li class="chapter-item expanded "><a href="../../approximate_counting/approximate_counting.html"><strong aria-hidden="true">19.</strong> Approximate Counting Algorithm</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Arcane Algorithm Archive</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/algorithm-archivists/algorithm-archive/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="convolutions-in-1d"><a class="header" href="#convolutions-in-1d">Convolutions in 1D</a></h1>
<p>As mentioned in the <a href="../convolutions.html">introductory section for convolutions</a>, convolutions allow mathematicians to &quot;blend&quot; two seemingly unrelated functions; however, this definition is not very rigorous, so it might be better to think of a convolution as a method to apply a filter to a signal or image.
This, of course, brings up more questions: what is a filter? What is a signal? How is this all related to images?</p>
<p>For this, we will start with some predefined signal.
It does not matter too much what it is, so we will pick a square wave where everything is set to zero except for a few elements at the center, which will be set to one.
This signal can be treated as an array, or a black and white, one-dimensional image where everything is black except for a white strip at the center.
We will also introduce a filter, which will be a simple triangle wave that goes to 1.
Both of these are shown below:</p>
<p float="center">
    <img src="../res/square_wave.png" style="width:49%">
    <img src="../res/triangle_wave.png" style="width:49%">
</p>
<p>So now we have a signal and a filter.
How do we apply the filter to the signal?
The easiest way to do this is to iterate through every point in the signal and blend it with neighboring elements, where each neighboring element is weighted based on the filter value.
So in the case where the triangle wave is only 3 elements (<code>[0.5, 1, 0.5]</code>), the output at each point would be</p>
<p>\[ C_n = \frac{A_{n-1}}{2} + A_{n} + \frac{A_{n+1}}{2}, \]</p>
<p>where \( C \) is the output value, \( A \) is the input array (a signal or image), and \( n \) is an iterable element through that signal.
In this way, the &quot;application of a filter,&quot; is simply a multiplication of the triangle wave centered around each point of the input array, followed by in integral or sum of the output.
In some sense, this means we will shift the filter, then multiply and sum every step.
This can be seen in the following animation:</p>
<div style="text-align:center">
<video style="width:90%" controls loop>
  <source src="../res/triangle_square_conv.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>
</div>
<p>Here, the purple, dashed line is the output convolution \( C \), the vertical line is the iteration \( n \), the blue line is the original signal, the red line is the filter, and the green area is the signal multiplied by the filter at that location.
The convolution at each point is the integral (sum) of the green area for each point.</p>
<p>If we extend this concept into the entirety of discrete space, it might look like this:</p>
<p>\( (f*g)[n] = \sum_{m = -\infty}^{\infty}f[m]g[n-m] = \sum_{m = -\infty}^{\infty}f[n-m]g[m] \)</p>
<p>Where <code>f[n]</code> and <code>g[n]</code> are arrays of some form.
This means that the convolution can calculated by shifting either the filter along the signal or the signal along the filter.
This can be read as we said before: every step, we shift the filter, multiply, and sum.
There is, of course, a small caveat here.
Why are we subtracting \( m \)?
Certainly, if we wanted to &quot;shift the filter along the signal,&quot; we could also do so by <em>adding</em> \( m \) instead, but that is actually an entirely separate operation known as a <em>correlation</em>, which will be discussed at a later time.</p>
<p>The simplest interpretation for this equation is the same as the animation: we reverse the second array, and move it through the first array one step at a time, performing a simple element-wise multiplication and summation at each step.
With this in mind, we can almost directly transcribe the discrete equation into code like so:</p>
<pre><code class="language-julia">function convolve_linear(signal::Array{T, 1}, filter::Array{T, 1},
                         output_size) where {T &lt;: Number}

    # convolutional output
    out = Array{Float64,1}(undef, output_size)
    sum = 0

    for i = 1:output_size
        for j = max(1, i-length(filter)):i
            if j &lt;= length(signal) &amp;&amp; i-j+1 &lt;= length(filter)
                sum += signal[j] * filter[i-j+1]
            end
        end

        out[i] = sum
        sum = 0
    end

    return out
end
</code></pre>
<pre><code class="language-csharp">        static double[] ConvolveLinear(double[] signal, double[] filter, int outputSize)
        {
            // Convolutional output.
            var output = new double[outputSize];
            var sum = 0.0;

            for (var i = 0; i &lt; outputSize; i++)
            {
                for (var j = Math.Max(0, i - filter.Length); j &lt;= i; j++)
                {
                    if (j &lt; signal.Length &amp;&amp; (i - j) &lt; filter.Length)
                    {
                        sum += signal[j] * filter[i - j];
                    }
                }

                output[i] = sum;
                sum = 0.0;
            }

            return output;
        }
</code></pre>
<pre><code class="language-python">def convolve_linear(signal, filter_array, output_size):
    out = np.zeros(output_size)
    s = 0

    for i in range(output_size):
        for j in range(max(0, i - len(filter_array)), i + 1):
            if j &lt; len(signal) and (i - j) &lt; len(filter_array):
                s += signal[j] * filter_array[i - j]
        out[i] = s
        s = 0

    return out
</code></pre>
<p>The easiest way to reason about this code is to read it as you might read a textbook.
For each element in the output domain, we are summing a certain subsets of elements from <code>i-length(filter)</code> to <code>i</code> after multiplying it by the reversed filter (<code>filter[i-j]</code>).
In this way, it is precisely the same as the mathematical notation mentioned before.</p>
<p>In contrast to the animation, where the filter continuously reappears on the left edge of the screen, the code we have written for this part of the chapter requires the user to specify what they expect the output array length to be.
Determining what should happen at the edges of the convolution is a somewhat hotly debated topic and differs depending on what the user actually wants, so we will be discussing this in greater detail later in this chapter.</p>
<p>As an important note, if we were to extend the convolution into continuous space, we might write something like:</p>
<p>\( (f*g)(x) = \int_{-\infty}^{\infty}f(\xi)g(x-\xi)d\xi = \int_{-\infty}^{\infty}f(x-\xi)g(\xi)d\xi \)</p>
<p>Note that in this case, \( x \) and \( \xi \) are not necessarily spatial elements, but the interpretation is otherwise the same as before.</p>
<p>At this stage, the mathematics and code might still be a little opaque, so it is a good idea to play around a bit and think about how this operation might be used in practice with a few different filters.</p>
<h2 id="playing-with-filters"><a class="header" href="#playing-with-filters">Playing with filters</a></h2>
<p>Honestly, the best way to learn how convolutions work is by using them for a number of different signals and filters, so
let us extend the previous triangle filter a bit further by convolving a square wave with a relatively sharp Gaussian, which can be seen in the following animation:</p>
<div style="text-align:center">
<video style="width:90%" controls loop>
  <source src="../res/1d_gaussian.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>
</div>
<p>In practice, the convolutional output here is very similar to the triangle wave we showed before.
The final convolved image looks a lot like the square, except that its boundaries have been smoothed out or &quot;blurred.&quot;
In practice whenever a Gaussian filter is used, it will always blur the other convolved signal, which is why a convolution with a Gaussian is also called a <em>blurring operation</em>.
This operation is used very often when dealing with two-dimensional images, and we will discuss common kernels found in the wild in <a href="../2d/2d.html">the next section</a>.
Still, it is interesting to see the blurring operation in action by convolving a random distribution with a larger Gaussian filter:</p>
<div style="text-align:center">
<video style="width:90%" controls loop>
  <source src="../res/1d_rand_gaussian_cyclic.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>
</div>
<p>In this animation, the final convolution is so blurred that it does not seem related to the random input signal at all!
In fact, this animation seems to blend much more when compared to the previous Gaussian and the triangle wave animations.
This is because the Gaussian is wider than the previous to filters.
In general, the wider the filter, the stronger the blurring effect.</p>
<p>So what happens if we convolve a Gaussian with another Gaussian?
Well, that is shown below:</p>
<div style="text-align:center">
<video style="width:90%" controls loop>
  <source src="../res/double_gaussian.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>
</div>
<p>As one might expect, the output is a blurrier Gaussian, which is essentially just wider.
If you were paying particularly close attention to the visualization, you might have noticed that the green area inside this visualization does not properly line up with the overlap of the two arrays.
Don't worry!
This is exactly what should happen!
Remember that the convolution requires a <em>multiplication</em> of the signal and filter, which was the same as the overlap when the signal was a square wave; however, in the case of two distinct signals, we should expect the multiplied output to look somewhat distinct.</p>
<p>Let us extend this concept to one final example of a square wave convolved with a triangular, sawtooth function that looks like this:</p>
<p>
  <img  class="center" src="../res/sawtooth.png" style="width:60%" />
</p>
<p>This is the first non-symmetric filter of this chapter, and its convolution would look like this:</p>
<div style="text-align:center">
<video style="width:90%" controls loop>
  <source src="../res/1d_sawtooth.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>
</div>
<p>Non-symmetric filters are useful for testing convolutions to ensure that the output is correct, so it might be worthwhile to linger on this animation for a bit longer.
Notice how the convolution has an accelerating, positive slope when the reversed sawtooth function interacts with the square.
This makes sense as the smallest part of the triangle interacts first.
Similarly, there is a negatively accelerating slope when the sawtooth function leaves the square.</p>
<h2 id="dealing-with-boundaries"><a class="header" href="#dealing-with-boundaries">Dealing with boundaries</a></h2>
<p>In all of the animations, we have shown the filter constantly reappearing on the left edge of the screen, which is not always the best thing to do at the boundaries.
In fact, these boundary conditions are somewhat non-trivial to code, so for this section, we will start with relatively simple boundary conditions that were introduced in the previous code example.</p>
<h3 id="simple-boundaries"><a class="header" href="#simple-boundaries">Simple boundaries</a></h3>
<p>In general, if a user wants to see a full convolution between two signals, the output size must be the size of the two signals put together, otherwise, we cannot iterate through the entire convolutional output domain.
For example, here is random noise again convolved with a Gaussian function, but with non-periodic boundaries:</p>
<div style="text-align:center">
<video style="width:90%" controls>
  <source src="../res/1d_rand_gaussian_full.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>
</div>
<p>This shows the full, unbounded convolution of the two signals, where
we clearly see a &quot;ramp up&quot; and &quot;ramp down&quot; phase at the start and end of the animation.
That said, there are many applications where the user actually needs to specify the output domain to be another length, such as the size of one of the input signals.</p>
<p>In this case, the simplest boundary would be to assume that whenever the filter hits the end of the image, it simply disappears.
Another way to think about this is that the signal only exists for the domain we specify it over, and is all 0s outside of this domain; therefore, the filter does not sum any signal from elements beyond its scope.
As an example, let's take the same example as before:</p>
<div style="text-align:center">
<video style="width:90%" controls>
  <source src="../res/1d_rand_gaussian_simple.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>
</div>
<p>Similar to the case without boundary conditions, this convolution needs to &quot;ramp up,&quot; but it does not need to &quot;ramp down.&quot;
This is because the convolution output no longer extends past the bounds of the original signal so the bounded convolution is a subset of the full convolution.
More than that, the convolution does not go all the way to 0 on the right side.
This means that we are actually ignoring a rather important part of the convolution!</p>
<p>This is 100% true; however, if the signal is large and the filter is small (as is the case with most of image processing), we do not really care that much about the bits of the convolution we missed.
In addition, there is a way to center the convolution by modifying the location where the filter starts.
For example, we could have half of the filter already existing and overlapping with the signal for the very first computed point of the convolution.
For this reason, simple bounds are used frequently when performing convolutions on an image.</p>
<p>In the previous code snippet, we were able to perform both a bounded and unbounded convolution.
Here it is again for clarity:</p>
<pre><code class="language-julia">function convolve_linear(signal::Array{T, 1}, filter::Array{T, 1},
                         output_size) where {T &lt;: Number}

    # convolutional output
    out = Array{Float64,1}(undef, output_size)
    sum = 0

    for i = 1:output_size
        for j = max(1, i-length(filter)):i
            if j &lt;= length(signal) &amp;&amp; i-j+1 &lt;= length(filter)
                sum += signal[j] * filter[i-j+1]
            end
        end

        out[i] = sum
        sum = 0
    end

    return out
end
</code></pre>
<pre><code class="language-csharp">        static double[] ConvolveLinear(double[] signal, double[] filter, int outputSize)
        {
            // Convolutional output.
            var output = new double[outputSize];
            var sum = 0.0;

            for (var i = 0; i &lt; outputSize; i++)
            {
                for (var j = Math.Max(0, i - filter.Length); j &lt;= i; j++)
                {
                    if (j &lt; signal.Length &amp;&amp; (i - j) &lt; filter.Length)
                    {
                        sum += signal[j] * filter[i - j];
                    }
                }

                output[i] = sum;
                sum = 0.0;
            }

            return output;
        }
</code></pre>
<pre><code class="language-python">def convolve_linear(signal, filter_array, output_size):
    out = np.zeros(output_size)
    s = 0

    for i in range(output_size):
        for j in range(max(0, i - len(filter_array)), i + 1):
            if j &lt; len(signal) and (i - j) &lt; len(filter_array):
                s += signal[j] * filter_array[i - j]
        out[i] = s
        s = 0

    return out
</code></pre>
<p>Here, the main difference between the bounded and unbounded versions is that the output array size is smaller in the bounded case.
For an unbounded convolution, the function would be called with a the output array size specified to be the size of both signals put together:</p>
<pre><code class="language-julia">    # full convolution, output will be the size of x + y - 1
    full_linear_output = convolve_linear(x, y, length(x) + length(y) - 1)
</code></pre>
<pre><code class="language-csharp">            // Full convolution, output will be the size of x + y - 1.
            var fullLinearOutput = ConvolveLinear(x, y, x.Length + y.Length - 1);
</code></pre>
<pre><code class="language-python"># full convolution, output will be the size of x + y - 1
full_linear_output = convolve_linear(x, y, len(x) + len(y) - 1)
</code></pre>
<p>On the other hand, the bounded call would set the output array size to simply be the length of the signal</p>
<pre><code class="language-julia">    # simple boundaries
    simple_linear_output = convolve_linear(x, y, length(x))
</code></pre>
<pre><code class="language-csharp">            // Simple boundaries.
            var simpleLinearOutput = ConvolveLinear(x, y, x.Length);
</code></pre>
<pre><code class="language-python"># simple boundaries
simple_linear_output = convolve_linear(x, y, len(x))
</code></pre>
<p>Finally, as we mentioned before, it is possible to center bounded convolutions by changing the location where we calculate the each point along the filter.
This can be done by modifying the following line:</p>
<pre><code class="language-julia">        for j = max(1, i-length(filter)):i
</code></pre>
<pre><code class="language-csharp">                for (var j = Math.Max(0, i - filter.Length); j &lt;= i; j++)
</code></pre>
<pre><code class="language-python">        for j in range(max(0, i - len(filter_array)), i + 1):
</code></pre>
<p>Here, <code>j</code> counts from <code>i-length(filter)</code> to <code>i</code>.
To center the convolution, it would need to count from <code>i-(length(filter)/2)</code> to <code>i+(length(filter)/2)</code> instead.</p>
<p>I think this is a good place to stop discussions on simple boundary conditions.
Now let us talk a bit more in detail about the case where we want the filter to continuously reappear every loop.
This case is known as the &quot;periodic boundary condition&quot; and was used for the visualizations at the start of this chapter.</p>
<h3 id="periodic-boundary-conditions"><a class="header" href="#periodic-boundary-conditions">Periodic boundary conditions</a></h3>
<p>Though periodic boundary conditions are more complicated that those mentioned in the previous section, they are still <em>relatively</em> straightforward to implement.
With these conditions, the filter will wrap itself around to the other end of the signal whenever it hits a boundary.
In this way, the signal is periodic, with an identical copy of itself acting as left and right neighbors.
Those neighbors then have other neighbors, and those then have more neighbors, creating a sea of signals extending to infinity and beyond in both directions.
For us, this means that when the filter leaves one edge of the domain, it simply appears on the other, opposite edge.</p>
<p>This particular convolution is known as a <em>cyclic</em> convolution and is also the most common output of convolutions that work via the <a href="../convolutional_theorem/convolutional_theorem.html">convolutional theorem</a>, which will be discussed in another section.
For clarity: here is the same cyclic visualization we showed above with a random distribution and a Gaussian signal.</p>
<div style="text-align:center">
<video style="width:90%" controls loop>
  <source src="../res/1d_rand_gaussian_cyclic.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>
</div>
<p>In code, this typically amounts to using some form of modulus operation, as shown here:</p>
<pre><code class="language-julia">function convolve_cyclic(signal::Array{T, 1},
                         filter::Array{T, 1}) where {T &lt;: Number}

    # output size will be the size of sign
    output_size = max(length(signal), length(filter))

    # convolutional output
    out = Array{Float64,1}(undef,output_size)
    sum = 0

    for i = 1:output_size
        for j = 1:output_size
            sum += get(signal, mod1(j, output_size), 0) * get(filter, mod1(i-j, output_size), 0)
        end

        out[i] = sum
        sum = 0

    end

    return out
end
</code></pre>
<pre><code class="language-csharp">        static double[] ConvolveCyclic(double[] signal, double[] filter)
        {
            var outputSize = Math.Max(signal.Length, filter.Length);

            // Convolutional output.
            var output = new double[outputSize];
            var sum = 0.0;

            for (var i = 0; i &lt; outputSize; i++)
            {
                for (var j = 0; j &lt; outputSize; j++)
                {
                    if (Mod(i - j, outputSize) &lt; filter.Length)
                    {
                        sum += signal[Mod(j - 1, outputSize)] * filter[Mod(i - j, outputSize)];
                    }
                }

                output[i] = sum;
                sum = 0.0;
            }

            return output;
        }
</code></pre>
<pre><code class="language-python">def convolve_cyclic(signal, filter_array):
    output_size = max(len(signal), len(filter_array))
    out = np.zeros(output_size)
    s = 0

    for i in range(output_size):
        for j in range(output_size):
            if(mod1(i - j, output_size) &lt; len(filter_array)):
                s += signal[mod1(j - 1, output_size)] * filter_array[mod1(i - j, output_size)]
        out[i] = s
        s = 0

    return out
</code></pre>
<p>This is essentially the same as before, except for the modulus operations, which allow us to work on a periodic domain.</p>
<p>As a final note before continuing: dealing with boundaries is tricky business and can dramatically change the behavior of the output convolution.
For this reason, it is important to think about what types of boundaries will work best for what you, the programmer, actually need.
The selection of boundary conditions will be a common trope for a large portion of computer graphics and physics algorithms where researchers often need to present and simulate data on an array of some sort.</p>
<h2 id="example-code"><a class="header" href="#example-code">Example Code</a></h2>
<p>For the code associated with this chapter, we have used the convolution to generate a few files for the full convolution, along with the periodic and simple boundary conditions discussed in this chapter.</p>
<pre><code class="language-julia">using DelimitedFiles
using LinearAlgebra

function convolve_cyclic(signal::Array{T, 1},
                         filter::Array{T, 1}) where {T &lt;: Number}

    # output size will be the size of sign
    output_size = max(length(signal), length(filter))

    # convolutional output
    out = Array{Float64,1}(undef,output_size)
    sum = 0

    for i = 1:output_size
        for j = 1:output_size
            sum += get(signal, mod1(j, output_size), 0) * get(filter, mod1(i-j, output_size), 0)
        end

        out[i] = sum
        sum = 0

    end

    return out
end

function convolve_linear(signal::Array{T, 1}, filter::Array{T, 1},
                         output_size) where {T &lt;: Number}

    # convolutional output
    out = Array{Float64,1}(undef, output_size)
    sum = 0

    for i = 1:output_size
        for j = max(1, i-length(filter)):i
            if j &lt;= length(signal) &amp;&amp; i-j+1 &lt;= length(filter)
                sum += signal[j] * filter[i-j+1]
            end
        end

        out[i] = sum
        sum = 0
    end

    return out
end

function main()

    # sawtooth functions for x and y
    x = [float(i)/200 for i = 1:200]
    y = [float(i)/200 for i = 1:200]

    # Normalization is not strictly necessary, but good practice
    normalize!(x)
    normalize!(y)

    # full convolution, output will be the size of x + y - 1
    full_linear_output = convolve_linear(x, y, length(x) + length(y) - 1)

    # simple boundaries
    simple_linear_output = convolve_linear(x, y, length(x))

    # cyclic convolution
    cyclic_output = convolve_cyclic(x, y)

    # outputting convolutions to different files for plotting in external code
    writedlm(&quot;full_linear.dat&quot;, full_linear_output)
    writedlm(&quot;simple_linear.dat&quot;, simple_linear_output)
    writedlm(&quot;cyclic.dat&quot;, cyclic_output)

end
</code></pre>
<pre><code class="language-csharp">ï»¿using System;
using System.IO;

namespace Convolution1D
{
    public class Convolution1D
    {
        // Creates a sawtooth function with the given length.
        static double[] CreateSawtooth(int length)
        {
            var array = new double[length];
            for (var i = 0; i &lt; length; i++)
                array[i] = (i + 1) / 200f;
            return array;
        }

        // Normalizes the given array.
        static void Normalize(double[] array)
        {
            var norm = Norm(array);
            for (var i = 0; i &lt; array.Length; i++)
                array[i] /= norm;
        }

        // Calculates the norm of the array.
        static double Norm(double[] array)
        {
            var sum = 0.0;
            for (var i = 0; i &lt; array.Length; i++)
                sum += Math.Pow(array[i], 2);
            return Math.Sqrt(sum);
        }

        // Modulus function which handles negative values properly.
        // Assumes that y &gt;= 0.
        static int Mod(int x, int y) =&gt; ((x % y) + y) % y;

        static double[] ConvolveCyclic(double[] signal, double[] filter)
        {
            var outputSize = Math.Max(signal.Length, filter.Length);

            // Convolutional output.
            var output = new double[outputSize];
            var sum = 0.0;

            for (var i = 0; i &lt; outputSize; i++)
            {
                for (var j = 0; j &lt; outputSize; j++)
                {
                    if (Mod(i - j, outputSize) &lt; filter.Length)
                    {
                        sum += signal[Mod(j - 1, outputSize)] * filter[Mod(i - j, outputSize)];
                    }
                }

                output[i] = sum;
                sum = 0.0;
            }

            return output;
        }

        static double[] ConvolveLinear(double[] signal, double[] filter, int outputSize)
        {
            // Convolutional output.
            var output = new double[outputSize];
            var sum = 0.0;

            for (var i = 0; i &lt; outputSize; i++)
            {
                for (var j = Math.Max(0, i - filter.Length); j &lt;= i; j++)
                {
                    if (j &lt; signal.Length &amp;&amp; (i - j) &lt; filter.Length)
                    {
                        sum += signal[j] * filter[i - j];
                    }
                }

                output[i] = sum;
                sum = 0.0;
            }

            return output;
        }

        static void Main()
        {
            // Create sawtooth functions for x and y.
            var x = CreateSawtooth(200);
            var y = CreateSawtooth(200);

            // Normalization is not strictly necessary, but good practice.
            Normalize(x);
            Normalize(y);

            // Full convolution, output will be the size of x + y - 1.
            var fullLinearOutput = ConvolveLinear(x, y, x.Length + y.Length - 1);
            // Simple boundaries.
            var simpleLinearOutput = ConvolveLinear(x, y, x.Length);
            // Cyclic convolution.
            var cyclicOutput = ConvolveCyclic(x, y);

            // Output convolutions to different files for plotting.
            File.WriteAllText(&quot;full_linear.dat&quot;, String.Join(Environment.NewLine, fullLinearOutput));
            File.WriteAllText(&quot;simple_linear.dat&quot;, String.Join(Environment.NewLine, simpleLinearOutput));
            File.WriteAllText(&quot;cyclic.dat&quot;, String.Join(Environment.NewLine, cyclicOutput));
        }
    }
}

</code></pre>
<pre><code class="language-python">import numpy as np

def mod1(x, y): return ((x % y) + y) % y

def convolve_cyclic(signal, filter_array):
    output_size = max(len(signal), len(filter_array))
    out = np.zeros(output_size)
    s = 0

    for i in range(output_size):
        for j in range(output_size):
            if(mod1(i - j, output_size) &lt; len(filter_array)):
                s += signal[mod1(j - 1, output_size)] * filter_array[mod1(i - j, output_size)]
        out[i] = s
        s = 0

    return out


def convolve_linear(signal, filter_array, output_size):
    out = np.zeros(output_size)
    s = 0

    for i in range(output_size):
        for j in range(max(0, i - len(filter_array)), i + 1):
            if j &lt; len(signal) and (i - j) &lt; len(filter_array):
                s += signal[j] * filter_array[i - j]
        out[i] = s
        s = 0

    return out

# sawtooth functions for x and y
x = [float(i + 1)/200 for i in range(200)]
y = [float(i + 1)/200 for i in range(200)]

# Normalization is not strictly necessary, but good practice
x /= np.linalg.norm(x)
y /= np.linalg.norm(y)

# full convolution, output will be the size of x + y - 1
full_linear_output = convolve_linear(x, y, len(x) + len(y) - 1)

# simple boundaries
simple_linear_output = convolve_linear(x, y, len(x))

# cyclic convolution
cyclic_output = convolve_cyclic(x, y)

# outputting convolutions to different files for plotting in external code
np.savetxt('full_linear.dat', full_linear_output)
np.savetxt('simple_linear.dat', simple_linear_output)
np.savetxt('cyclic.dat', cyclic_output)
</code></pre>
<p>At a test case, we have chosen to use two sawtooth functions, which should produce the following images:</p>
<table><thead><tr><th>Description</th><th>Image</th></tr></thead><tbody>
<tr><td>Simple Boundaries</td><td><img  class="center" src="../res/simple_linear.png" style="width:100%" /></td></tr>
<tr><td>Full</td><td><img  class="center" src="../res/full_linear.png" style="width:100%" /></td></tr>
<tr><td>Cyclic</td><td><img  class="center" src="../res/cyclic.png" style="width:100%" /></td></tr>
</tbody></table>
<p>As a sanity check, make sure that the bounded convolution is a subset of the full convolution.
In this example, the bounded convolution is the start of the full convolution, but it is entirely possible it could be the middle or somewhere else entirely depending on how you counted within the inner, summation loop for the convolution.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<h5 id="code-examples"><a class="header" href="#code-examples">Code Examples</a></h5>
<p>The code examples are licensed under the MIT license (found in <a href="https://github.com/algorithm-archivists/algorithm-archive/blob/master/LICENSE.md">LICENSE.md</a>).</p>
<h5 id="imagesgraphics"><a class="header" href="#imagesgraphics">Images/Graphics</a></h5>
<ul>
<li>The image &quot;<a href="../res/square_wave.png">Square Wave</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The image &quot;<a href="../res/triangle_wave.png">Triangle Wave</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The video &quot;<a href="../res/triangle_square_conv.mp4">Triangle Square Convolution</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The video &quot;<a href="../res/1d_gaussian.mp4">Gaussian Square Convolution</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The video &quot;<a href="../res/1d_rand_gaussian_cyclic.mp4">Gaussian Random Convolution</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The video &quot;<a href="../res/double_gaussian.mp4">Double Convolution</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The image &quot;<a href="../res/sawtooth.png">Sawtooth Wave</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The video &quot;<a href="../res/1d_sawtooth.mp4">Sawtooth Square Convolution</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The video &quot;<a href="../res/1d_rand_gaussian_full.mp4">Full Random Convolution</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The video &quot;<a href="../res/1d_rand_gaussian_simple.mp4">Simple Random Convolution</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The image &quot;<a href="../res/simple_linear.png">Simple Linear</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The image &quot;<a href="../res/full_linear.png">Full Linear</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The image &quot;<a href="../res/cyclic.png">Cyclic</a>&quot; was created by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
</ul>
<h5 id="text"><a class="header" href="#text">Text</a></h5>
<p>The text of this chapter was written by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
<p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><p><img  class="center" src="../../cc/CC-BY-SA_icon.svg" /></p></a></p>
<h5 id="pull-requests"><a class="header" href="#pull-requests">Pull Requests</a></h5>
<p>After initial licensing (<a href="https://github.com/algorithm-archivists/algorithm-archive/pull/560">#560</a>), the following pull requests have modified the text or graphics of this chapter:</p>
<ul>
<li>none</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../convolutions/convolutions.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../convolutions/multiplication/multiplication.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../convolutions/convolutions.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../convolutions/multiplication/multiplication.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://0.0.0.0:3000/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
